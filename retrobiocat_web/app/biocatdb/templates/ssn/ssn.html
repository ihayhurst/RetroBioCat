{% extends "base.html" %}
{% set active_page = "" %}

{% block content %}
    <style>
        #myssn {
            width: 100%;
            height:87vh;
            background-color: white;
            border: 1px solid lightgray;
            position: relative;
            float: left; }
    </style>

    <div style="overflow-y: hidden; height:90vh">
        {% include 'ssn/ssn_top_bar.html' %}
        <div id="myssn"></div>
    </div>

    {% include 'ssn/modals/network_physics_modal.html' %}

    <script type="text/javascript">
        // initialize global variables.
        var container = document.getElementById('myssn');

        var edges_options = {'smooth': false}

        var physics_options = {'stabilization': {'enabled': true,
                                                 'iterations': 50},
                                "repulsion": {
                                   "centralGravity": 0.1,
                                   "nodeDistance": 500
                                },
                                "maxVelocity": 49,
                                "minVelocity": 0.75,
                                "solver": "repulsion",
                                "timestep": 0.75}

        var interaction_options = {'tooltipDelay': 0,
                                   'hideEdgesOnDrag': true}


        var options = {edges: edges_options,
                       physics: physics_options,
                       interaction: interaction_options,
                       configure: {filter: function (option, path) {
                                    if (path.indexOf("physics") !== -1) {
                                        return true;}
                                    if (path.indexOf("smooth") !== -1 || option === "smooth") {
                                        return true;
                                    }
                                    return false;},
                                    container: document.getElementById("ssn_network_config")},
                      };

        function edgesFilter(edge) {
            return (edge.weight >= document.getElementById("alignment_score").value);
        }

        const edges = new vis.DataSet({{edges|tojson}})
        const nodes = new vis.DataSet({{nodes|tojson}})
        const edgesView = new vis.DataView(edges, { filter: edgesFilter });
        edgesView.refresh();

        var data = {'nodes': nodes, 'edges': edgesView};

        var network = new vis.Network(container, data, options);

        network.on("selectNode", function (params) {
            console.log(params)
            if (params.nodes.length === 1) {
                if (network.isCluster(params.nodes[0]) === true) {
                    network.openCluster(params.nodes[0]);
                }
            }
        });

        document.getElementById("alignment_score").onchange = function(){
            edgesView.refresh()
        }


        function clusterByHubsize() {
            network.setData(data);
            var clusterOptionsByData = {
                joinCondition:function(nodeOptions) {
                    return nodeOptions.node_type !== 'biocatdb';
                  },
                processProperties: function (clusterOptions, childNodes) {
                    clusterOptions.label = "[" + childNodes.length + "]";
                    return clusterOptions;
                },
                clusterNodeProperties: {
                    borderWidth: 3,
                    shape: "box",
                    font: { size: 30 },
                },
            };

            network.clusterByHubsize(undefined, clusterOptionsByData);
        }
    </script>

{% endblock %}
